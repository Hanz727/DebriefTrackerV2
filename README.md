# DebriefTracker documentation
This program is responsible for processing the data from the postgres database
as well as displaying it in a readable manner to users on discord.

## MsnDataFile
This is a json file generated by DebriefTracker.lua which is embedded into
the DCS mission. It must have a directory of ../MissionData relative to base dir.
It has the following format:
```python 
class MsnDataEntry:
    type: int         # weapon type, 0: 'A/G' 1: 'A/A'
    weapon_name: str
    dl_callsign: str  # I.E. VY11, BR11. Not used for anything at the moment
    tail_number: str
    pilot_name: str
    rio_name: str
    tgt_name: str
    tgt_tname: str    # type name
    speed: float
    angels: int
    angels_tgt: int
    range: int
    destroyed: bool
    hit: bool
```
Note that the above is an abstraction of a single entry in the json, the actual format looks like this:
```json
[
  {
    "TYPE": 1,
    "WEAPON_NAME": "AIM-54C-Mk60",
    "DL_CALLSIGN": "VY11",
    "TAIL_NUMBER": "103",
    "PILOT_NAME": "Fenrir",
    "RIO_NAME": "Vex",
    "TGT_NAME": "mig-29c",
    "TGT_TNAME": "MiG-29S",
    "SPEED": 0.95,
    "ANGELS": 31,
    "ANGELS_TGT": 22,
    "RANGE": 50,
    "DESTROYED": true,
    "HIT": true
  },
  {
    "TYPE": 1,
    "WEAPON_NAME": "AIM-54C-Mk60",
    "DL_CALLSIGN": "VY12",
    "TAIL_NUMBER": "100",
    "PILOT_NAME": "Kroner",
    "RIO_NAME": "",
    "TGT_NAME": "mig-29c",
    "TGT_TNAME": "MiG-29S",
    "SPEED": 0.91,
    "ANGELS": 29,
    "ANGELS_TGT": 26,
    "RANGE": 34,
    "DESTROYED": false,
    "HIT": false
  }
]
```

## Auto mode
The purpose of the auto mode is to automatically store the data gathered 
by the in-mission lua script (MsnDataFile) into the postgres database,
instead of requiring user input. It works by reading the newest 
by date modified MsnDataFile json and inserting each modification to the file
into the database. This also means that when the program starts and the
MsnDataFile is not empty, it will consider all its data new and insert
it into the db. To prevent it, a new file should be created in the same
dir to ensure its empty.\
Example of how that can be achieved:
```bash
cd MissionData
if exist "AUTOFILLER.json" del "AUTOFILLER.json"
echo [] > "AUTOFILLER.json"
cd ../DebriefTrackerV2
python main.py
```
Auto mode config attributes:
```json
"auto_mode": false -- Toggle
```

## Soft Reset
Soft reset is used to "zero the embeds" such that the database appears to 
be empty for the users on discord, all while preserving the stored data. 
It's achieved by adding a filter to each db search in embed_creator. 
The filter being ```self.__db.id_[-1] > self.soft_reset_anchor_id```.
It basically means that we're filtering out all the database entries
before a set sortable id, which is being updated each ``auto_soft_reset_interval_days``.
Note that not all embeds are zeroed by this feature, the air wing stats ``make_embed_17``
embed is untouched.

Soft reset has 2 config attributes:
```json
"auto_soft_reset": true,            -- Toggle
"auto_soft_reset_interval_days": 21 -- How often does the reset occur
```